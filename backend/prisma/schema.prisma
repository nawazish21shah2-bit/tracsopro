// Prisma Schema for Guard Tracking Backend
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String       @id @default(uuid())
  email                   String       @unique
  password                String
  firstName               String
  lastName                String
  phone                   String?
  role                    Role         @default(GUARD)
  accountType             AccountType?
  profilePictureUrl       String?
  isActive                Boolean      @default(true)
  isEmailVerified         Boolean      @default(false)
  emailVerificationToken  String?
  emailVerificationExpiry DateTime?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt

  guard              Guard?
  client             Client?
  incidents          Incident[]
  messages           Message[]
  notifications      Notification[]
  reports            Report[]
  shiftReports       ShiftReport[]
  userSettings       UserSettings?
  supportTickets     SupportTicket[]
  companyUsers       CompanyUser[]
  createdInvitations Invitation[]
  deviceTokens       DeviceToken[]

  @@index([email])
  @@index([role])
}

enum Role {
  GUARD
  ADMIN
  CLIENT
  SUPER_ADMIN
}

enum AccountType {
  INDIVIDUAL
  COMPANY
}

model Guard {
  id                String      @id @default(uuid())
  userId            String      @unique
  employeeId        String      @unique
  department        String?
  experience        String?
  profilePictureUrl String?
  idCardFrontUrl    String?
  idCardBackUrl     String?
  certificationUrls String[]
  hireDate          DateTime    @default(now())
  status            GuardStatus @default(ACTIVE)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  user               User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  locations          LocationAssignment[]
  trackingRecords    TrackingRecord[]
  emergencyContacts  EmergencyContact[]
  qualifications     Qualification[]
  performanceMetrics PerformanceMetric[]
  incidentReports    IncidentReport[]
  geofenceEvents     GeofenceEvent[]
  shifts             Shift[]
  companyGuards      CompanyGuard[]

  @@index([userId])
  @@index([employeeId])
  @@index([status])
}

enum GuardStatus {
  ACTIVE
  ON_DUTY
  OFF_DUTY
  ON_LEAVE
  SUSPENDED
  TERMINATED
}

model Client {
  id                        String      @id @default(uuid())
  userId                    String      @unique
  accountType               AccountType
  companyName               String?
  companyRegistrationNumber String?
  taxId                     String?
  address                   String?
  city                      String?
  state                     String?
  zipCode                   String?
  country                   String?
  website                   String?
  createdAt                 DateTime    @default(now())
  updatedAt                 DateTime    @updatedAt

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  sites          Site[]
  shifts         Shift[]
  companyClients CompanyClient[]

  @@index([userId])
  @@index([accountType])
}

model Site {
  id           String   @id @default(uuid())
  clientId     String
  name         String
  address      String
  latitude     Float?
  longitude    Float?
  description  String?
  requirements String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  client       Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  shifts       Shift[]
  companySites CompanySite[]

  @@index([clientId])
  @@index([isActive])
}

model Location {
  id          String       @id @default(uuid())
  name        String
  address     String
  latitude    Float
  longitude   Float
  type        LocationType
  description String?
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  assignments LocationAssignment[]
  incidents   Incident[]
  checkpoints Checkpoint[]
  shifts      Shift[]

  @@index([isActive])
  @@index([type])
}

enum LocationType {
  BUILDING
  CAMPUS
  FACILITY
  OUTDOOR
  CHECKPOINT
}

model LocationAssignment {
  id         String           @id @default(uuid())
  guardId    String
  locationId String
  startTime  DateTime
  endTime    DateTime?
  status     AssignmentStatus @default(ASSIGNED)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt

  guard    Guard    @relation(fields: [guardId], references: [id], onDelete: Cascade)
  location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@index([guardId])
  @@index([locationId])
  @@index([status])
}

enum AssignmentStatus {
  ASSIGNED
  ACTIVE
  COMPLETED
  CANCELLED
}

model TrackingRecord {
  id           String   @id @default(uuid())
  guardId      String
  latitude     Float
  longitude    Float
  accuracy     Float?
  batteryLevel Int?
  timestamp    DateTime @default(now())
  createdAt    DateTime @default(now())

  guard Guard @relation(fields: [guardId], references: [id], onDelete: Cascade)

  @@index([guardId])
  @@index([timestamp])
}

model Incident {
  id          String           @id @default(uuid())
  reportedBy  String
  locationId  String
  type        IncidentType
  severity    IncidentSeverity
  title       String
  description String
  status      IncidentStatus   @default(REPORTED)
  reportedAt  DateTime         @default(now())
  resolvedAt  DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  reporter User       @relation(fields: [reportedBy], references: [id])
  location Location   @relation(fields: [locationId], references: [id])
  evidence Evidence[]

  @@index([reportedBy])
  @@index([locationId])
  @@index([status])
  @@index([severity])
}

enum IncidentType {
  SECURITY_BREACH
  THEFT
  VANDALISM
  SUSPICIOUS_ACTIVITY
  MEDICAL_EMERGENCY
  FIRE
  NATURAL_DISASTER
  EQUIPMENT_FAILURE
  OTHER
}

enum IncidentSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IncidentStatus {
  REPORTED
  INVESTIGATING
  RESOLVED
  CLOSED
  ESCALATED
}

model Evidence {
  id          String       @id @default(uuid())
  incidentId  String
  type        EvidenceType
  url         String
  description String?
  uploadedAt  DateTime     @default(now())
  createdAt   DateTime     @default(now())

  incident Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)

  @@index([incidentId])
}

enum EvidenceType {
  PHOTO
  VIDEO
  AUDIO
  DOCUMENT
}

model Message {
  id             String   @id @default(uuid())
  senderId       String
  conversationId String
  content        String
  isRead         Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  sender User @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([conversationId])
  @@index([isRead])
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  data      String?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([type])
}

enum NotificationType {
  SHIFT_REMINDER
  INCIDENT_ALERT
  MESSAGE
  SYSTEM
  EMERGENCY
}

model Shift {
  id                 String      @id @default(uuid())
  guardId            String?     // Nullable - can be assigned later by admin
  siteId             String?
  clientId           String?
  locationId         String?
  locationName       String
  locationAddress    String
  scheduledStartTime DateTime
  scheduledEndTime   DateTime
  actualStartTime    DateTime?
  actualEndTime      DateTime?
  status             ShiftStatus @default(SCHEDULED)
  checkInLocation    Json? // { latitude, longitude, accuracy, address }
  checkOutLocation   Json? // { latitude, longitude, accuracy, address }
  description        String?
  notes              String?
  incidentCount      Int         @default(0)
  totalBreakTime     Int         @default(0) // in minutes
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt

  // Relations
  guard          Guard?            @relation(fields: [guardId], references: [id], onDelete: SetNull)
  site           Site?             @relation(fields: [siteId], references: [id], onDelete: SetNull)
  client         Client?           @relation(fields: [clientId], references: [id], onDelete: SetNull)
  location       Location?         @relation(fields: [locationId], references: [id], onDelete: SetNull)
  shiftBreaks    ShiftBreak[]
  shiftIncidents ShiftIncident[]
  shiftReports   ShiftReport[]
  checkpoints    ShiftCheckpoint[]

  @@index([guardId])
  @@index([siteId])
  @@index([clientId])
  @@index([locationId])
  @@index([status])
  @@index([scheduledStartTime])
  @@index([scheduledEndTime])
}

enum ShiftStatus {
  SCHEDULED
  IN_PROGRESS
  ON_BREAK
  COMPLETED
  CANCELLED
  NO_SHOW
  EARLY_END
}

model ShiftReport {
  id          String         @id @default(uuid())
  shiftId     String
  guardId     String
  reportType  ReportTypeEnum @default(SHIFT)
  content     String
  submittedAt DateTime       @default(now())
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  shift Shift @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  guard User  @relation(fields: [guardId], references: [id], onDelete: Cascade)

  @@index([shiftId])
  @@index([guardId])
  @@index([reportType])
}

enum ReportTypeEnum {
  SHIFT
  INCIDENT
  EMERGENCY
}

model Checkpoint {
  id         String   @id @default(uuid())
  locationId String
  name       String
  qrCode     String   @unique
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  location Location          @relation(fields: [locationId], references: [id], onDelete: Cascade)
  scans    ShiftCheckpoint[]

  @@index([locationId])
  @@index([qrCode])
}

model ShiftCheckpoint {
  id           String   @id @default(uuid())
  shiftId      String
  checkpointId String
  scannedAt    DateTime @default(now())
  latitude     Float?
  longitude    Float?
  notes        String?
  createdAt    DateTime @default(now())

  shift      Shift      @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  checkpoint Checkpoint @relation(fields: [checkpointId], references: [id], onDelete: Cascade)

  @@index([shiftId])
  @@index([checkpointId])
}

model EmergencyContact {
  id           String   @id @default(uuid())
  guardId      String
  name         String
  relationship String
  phone        String
  email        String?
  isPrimary    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  guard Guard @relation(fields: [guardId], references: [id], onDelete: Cascade)

  @@index([guardId])
}

model Qualification {
  id             String    @id @default(uuid())
  guardId        String
  title          String
  issuer         String
  issueDate      DateTime
  expiryDate     DateTime?
  certificateUrl String?
  isVerified     Boolean   @default(false)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  guard Guard @relation(fields: [guardId], references: [id], onDelete: Cascade)

  @@index([guardId])
  @@index([expiryDate])
}

model PerformanceMetric {
  id                String   @id @default(uuid())
  guardId           String
  month             Int
  year              Int
  totalShifts       Int      @default(0)
  completedShifts   Int      @default(0)
  missedShifts      Int      @default(0)
  incidentsReported Int      @default(0)
  averageRating     Float?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  guard Guard @relation(fields: [guardId], references: [id], onDelete: Cascade)

  @@unique([guardId, month, year])
  @@index([guardId])
}

model Report {
  id          String     @id @default(uuid())
  createdBy   String
  type        ReportType
  title       String
  description String?
  data        String
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  creator User @relation(fields: [createdBy], references: [id])

  @@index([createdBy])
  @@index([type])
  @@index([startDate])
}

enum ReportType {
  SHIFT_SUMMARY
  INCIDENT_SUMMARY
  PERFORMANCE
  ATTENDANCE
  LOCATION_COVERAGE
  CUSTOM
}

model IncidentReport {
  id                String   @id @default(uuid())
  guardId           String
  reportType        String
  description       String
  status            String   @default("SUBMITTED")
  locationName      String?
  locationAddress   String?
  locationLatitude  Float?
  locationLongitude Float?
  submittedAt       DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  guard Guard                 @relation(fields: [guardId], references: [id], onDelete: Cascade)
  media IncidentReportMedia[]

  @@index([guardId])
  @@index([reportType])
  @@index([status])
  @@index([submittedAt])
}

model IncidentReportMedia {
  id               String   @id @default(uuid())
  incidentReportId String
  url              String
  type             String // 'image' or 'video'
  name             String?
  createdAt        DateTime @default(now())

  incidentReport IncidentReport @relation(fields: [incidentReportId], references: [id], onDelete: Cascade)

  @@index([incidentReportId])
}

model UserSettings {
  id                 String   @id @default(uuid())
  userId             String   @unique
  pushNotifications  Boolean  @default(true)
  emailNotifications Boolean  @default(true)
  smsNotifications   Boolean  @default(false)
  shiftReminders     Boolean  @default(true)
  incidentAlerts     Boolean  @default(true)
  timezone           String?
  language           String   @default("en")
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model SupportTicket {
  id         String          @id @default(uuid())
  userId     String
  subject    String
  message    String
  category   SupportCategory @default(GENERAL)
  status     SupportStatus   @default(OPEN)
  priority   SupportPriority @default(NORMAL)
  assignedTo String?
  resolvedAt DateTime?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([priority])
}

enum SupportCategory {
  TECHNICAL
  BILLING
  GENERAL
  URGENT
}

enum SupportStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum SupportPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

model GeofenceEvent {
  id         String            @id @default(uuid())
  guardId    String
  geofenceId String
  eventType  GeofenceEventType
  latitude   Float
  longitude  Float
  accuracy   Float?
  timestamp  DateTime          @default(now())
  createdAt  DateTime          @default(now())

  guard Guard @relation(fields: [guardId], references: [id], onDelete: Cascade)

  @@index([guardId])
  @@index([geofenceId])
  @@index([eventType])
  @@index([timestamp])
}

enum GeofenceEventType {
  ENTER
  EXIT
}

model ShiftBreak {
  id        String    @id @default(uuid())
  shiftId   String
  startTime DateTime
  endTime   DateTime?
  breakType BreakType @default(REGULAR)
  location  Json? // { latitude, longitude, accuracy }
  notes     String?
  createdAt DateTime  @default(now())

  shift Shift @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([shiftId])
  @@index([startTime])
}

model ShiftIncident {
  id           String           @id @default(uuid())
  shiftId      String
  incidentType IncidentType
  severity     IncidentSeverity @default(LOW)
  title        String
  description  String
  location     Json? // { latitude, longitude, accuracy, address }
  reportedAt   DateTime         @default(now())
  resolvedAt   DateTime?
  status       IncidentStatus   @default(REPORTED)
  attachments  Json? // Array of file URLs
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  shift Shift @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([shiftId])
  @@index([incidentType])
  @@index([severity])
  @@index([status])
  @@index([reportedAt])
}

enum BreakType {
  REGULAR
  LUNCH
  EMERGENCY
  UNAUTHORIZED
}

// Super Admin Multi-Tenant Architecture Models
model SecurityCompany {
  id                    String             @id @default(uuid())
  name                  String
  registrationNumber    String?            @unique
  taxId                 String?
  email                 String             @unique
  phone                 String?
  address               String?
  city                  String?
  state                 String?
  zipCode               String?
  country               String?
  website               String?
  logo                  String?
  subscriptionPlan      SubscriptionPlan   @default(BASIC)
  subscriptionStatus    SubscriptionStatus @default(TRIAL)
  subscriptionStartDate DateTime           @default(now())
  subscriptionEndDate   DateTime?
  maxGuards             Int                @default(10)
  maxClients            Int                @default(5)
  maxSites              Int                @default(10)
  isActive              Boolean            @default(true)
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt

  // Relations
  users            CompanyUser[]
  guards           CompanyGuard[]
  clients          CompanyClient[]
  sites            CompanySite[]
  subscriptions    Subscription[]
  billingRecords   BillingRecord[]
  platformSettings PlatformSettings[]
  invitations      Invitation[]

  @@index([email])
  @@index([subscriptionStatus])
  @@index([isActive])
}

enum SubscriptionPlan {
  BASIC
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  SUSPENDED
  CANCELLED
  EXPIRED
}

model CompanyUser {
  id                String      @id @default(uuid())
  securityCompanyId String
  userId            String
  role              CompanyRole @default(EMPLOYEE)
  permissions       Json? // Custom permissions object
  isActive          Boolean     @default(true)
  joinedAt          DateTime    @default(now())
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  securityCompany SecurityCompany @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([securityCompanyId, userId])
  @@index([securityCompanyId])
  @@index([userId])
  @@index([role])
}

enum CompanyRole {
  OWNER
  ADMIN
  MANAGER
  SUPERVISOR
  EMPLOYEE
}

model CompanyGuard {
  id                String   @id @default(uuid())
  securityCompanyId String
  guardId           String
  employeeNumber    String?
  department        String?
  salary            Float?
  hourlyRate        Float?
  isActive          Boolean  @default(true)
  assignedAt        DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  securityCompany SecurityCompany @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)
  guard           Guard           @relation(fields: [guardId], references: [id], onDelete: Cascade)

  @@unique([securityCompanyId, guardId])
  @@index([securityCompanyId])
  @@index([guardId])
}

model CompanyClient {
  id                String    @id @default(uuid())
  securityCompanyId String
  clientId          String
  contractStartDate DateTime?
  contractEndDate   DateTime?
  contractValue     Float?
  paymentTerms      String?
  isActive          Boolean   @default(true)
  assignedAt        DateTime  @default(now())
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  securityCompany SecurityCompany @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)
  client          Client          @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@unique([securityCompanyId, clientId])
  @@index([securityCompanyId])
  @@index([clientId])
}

model CompanySite {
  id                String   @id @default(uuid())
  securityCompanyId String
  siteId            String
  contractDetails   Json? // Contract specific details
  isActive          Boolean  @default(true)
  assignedAt        DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  securityCompany SecurityCompany @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)
  site            Site            @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([securityCompanyId, siteId])
  @@index([securityCompanyId])
  @@index([siteId])
}

model Subscription {
  id                   String             @id @default(uuid())
  securityCompanyId    String
  plan                 SubscriptionPlan
  status               SubscriptionStatus
  startDate            DateTime
  endDate              DateTime?
  amount               Float
  currency             String             @default("USD")
  billingCycle         BillingCycle       @default(MONTHLY)
  paymentMethod        String?
  stripeSubscriptionId String?
  isActive             Boolean            @default(true)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt

  securityCompany SecurityCompany @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)

  @@index([securityCompanyId])
  @@index([status])
  @@index([endDate])
}

enum BillingCycle {
  MONTHLY
  QUARTERLY
  YEARLY
}

model BillingRecord {
  id                String        @id @default(uuid())
  securityCompanyId String
  subscriptionId    String?
  type              BillingType
  description       String
  amount            Float
  currency          String        @default("USD")
  status            BillingStatus @default(PENDING)
  dueDate           DateTime
  paidDate          DateTime?
  paymentMethod     String?
  invoiceNumber     String?       @unique
  stripeInvoiceId   String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  securityCompany SecurityCompany @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)

  @@index([securityCompanyId])
  @@index([status])
  @@index([dueDate])
  @@index([invoiceNumber])
}

enum BillingType {
  SUBSCRIPTION
  OVERAGE
  SETUP_FEE
  PENALTY
  REFUND
}

enum BillingStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

model PlatformSettings {
  id                String          @id @default(uuid())
  securityCompanyId String?
  key               String
  value             String
  category          SettingCategory @default(GENERAL)
  isGlobal          Boolean         @default(false)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  securityCompany SecurityCompany? @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)

  @@unique([securityCompanyId, key])
  @@index([securityCompanyId])
  @@index([category])
  @@index([isGlobal])
}

enum SettingCategory {
  GENERAL
  SECURITY
  BILLING
  NOTIFICATIONS
  INTEGRATIONS
  FEATURES
}

model PlatformAnalytics {
  id                String          @id @default(uuid())
  securityCompanyId String?
  metricType        AnalyticsMetric
  metricValue       Float
  dimensions        Json? // Additional dimensions/filters
  timestamp         DateTime        @default(now())
  createdAt         DateTime        @default(now())

  @@index([securityCompanyId])
  @@index([metricType])
  @@index([timestamp])
}

enum AnalyticsMetric {
  ACTIVE_GUARDS
  ACTIVE_CLIENTS
  ACTIVE_SITES
  TOTAL_SHIFTS
  COMPLETED_SHIFTS
  INCIDENTS_REPORTED
  REVENUE
  SUBSCRIPTION_RENEWALS
  USER_ENGAGEMENT
  SYSTEM_PERFORMANCE
}

model SystemAuditLog {
  id                String   @id @default(uuid())
  userId            String?
  securityCompanyId String?
  action            String
  resource          String
  resourceId        String?
  oldValues         Json?
  newValues         Json?
  ipAddress         String?
  userAgent         String?
  timestamp         DateTime @default(now())
  createdAt         DateTime @default(now())

  @@index([userId])
  @@index([securityCompanyId])
  @@index([action])
  @@index([resource])
  @@index([timestamp])
}

// Invitation System for Multi-Tenant Registration
model Invitation {
  id                String    @id @default(uuid())
  securityCompanyId String
  email             String? // Optional: specific email invitation
  role              Role // GUARD or CLIENT
  invitationCode    String    @unique
  expiresAt         DateTime
  usedAt            DateTime?
  usedBy            String? // userId who used it
  maxUses           Int       @default(1) // 1 = single use, >1 = multi-use
  currentUses       Int       @default(0)
  isActive          Boolean   @default(true)
  createdBy         String // userId who created invitation
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  securityCompany SecurityCompany @relation(fields: [securityCompanyId], references: [id], onDelete: Cascade)
  creator         User            @relation(fields: [createdBy], references: [id])

  @@index([securityCompanyId])
  @@index([invitationCode])
  @@index([email])
  @@index([expiresAt])
  @@index([isActive])
  @@index([role])
}

// Device Token for Push Notifications
model DeviceToken {
  id        String   @id @default(uuid())
  userId    String
  token     String
  platform  String   // 'ios' | 'android'
  deviceId  String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, token])
  @@index([userId])
  @@index([isActive])
  @@index([platform])
}
